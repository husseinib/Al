"use strict";(self.webpackChunkal=self.webpackChunkal||[]).push([[151],{3151:(F,e,t)=>{t.d(e,{WebGLRenderer:()=>Ve});var e=t(8507),r=t(9313),s=t(9104),a=t(5611),n=t(4459),i=t(4e3),o=t(2067),u=t(6665),c=t(108),_=t(8475),g=t(7222);class l{init(){var e=new g.k({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new r.u,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),t=(0,a.I)({name:"graphics",bits:[n.a,(0,i.P)(s.k),o.mA,u.m]});this.shader=new _.M({glProgram:t,resources:{localUniforms:e,batchSamplers:c.v}})}execute(e,t){var t=t.context,r=t.customShader||this.shader,s=e.renderer,{geometry:t,instructions:a}=s.graphicsContext.getContextRenderData(t),n=(r.groups[0]=s.globalUniforms.bindGroup,s.state.set(e.state),s.shader.bind(r),s.geometry.bind(t,r.glProgram),a.instructions);for(let e=0;e<a.instructionSize;e++){var i=n[e];if(i.size){for(let e=0;e<i.textures.textures.length;e++)s.texture.bind(i.textures.textures[e],e);s.geometry.draw("triangle-list",i.size,i.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}l.extension={type:[e.Ag.WebGLPipesAdaptor],name:"graphics"};var L=t(3391),h=t(4492),d=t(268);class f{init(){var e=(0,a.I)({name:"mesh",bits:[o.mA,L.m,u.m]});this._shader=new _.M({glProgram:e,resources:{uTexture:h.g.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new r.u}}}})}execute(e,t){var r=e.renderer;let s=t._shader;if(s){if(!s.glProgram)return void(0,d.R)("Mesh shader has no glProgram",t.shader)}else{s=this._shader;var a=t.texture,n=a.source;s.resources.uTexture=n,s.resources.uSampler=n.style,s.resources.textureUniforms.uniforms.uTextureMatrix=a.textureMatrix.mapCoord}s.groups[100]=r.globalUniforms.bindGroup,s.groups[101]=e.localUniformsBindGroup,r.encoder.draw({geometry:t._geometry,shader:s,state:t.state})}destroy(){this._shader.destroy(!0),this._shader=null}}f.extension={type:[e.Ag.WebGLPipesAdaptor],name:"mesh"};var m=t(7547);class E{constructor(){this._didUpload=!1,this._tempState=m.U.for2d()}init(e){var t=(0,a.I)({name:"batch",bits:[n.a,(0,i.P)(s.k),u.m]});this._shader=new _.M({glProgram:t,resources:{batchSamplers:c.v}}),e.renderer.runners.contextChange.add(this)}contextChange(){this._didUpload=!1}start(e,t){e=e.renderer;e.shader.bind(this._shader,this._didUpload),e.shader.updateUniformGroup(e.globalUniforms.uniformGroup),e.geometry.bind(t,this._shader.glProgram)}execute(e,t){var r=e.renderer,s=(this._didUpload=!0,this._tempState.blendMode=t.blendMode,r.state.set(this._tempState),t.textures.textures);for(let e=0;e<s.length;e++)r.texture.bind(s[e],e);r.geometry.draw("triangle-list",t.size,t.start)}destroy(){this._shader.destroy(!0),this._shader=null}}E.extension={type:[e.Ag.WebGLPipesAdaptor],name:"batch"};var M=t(2855),v=t(1293),H=t(5099),T=t(1132),b=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))({});class w{constructor(e,t){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.type=t}}class k{constructor(e){this._gpuBuffers=Object.create(null),this._boundBufferBases=Object.create(null),this._renderer=e}destroy(){this._renderer=null,this._gl=null,this._gpuBuffers=null,this._boundBufferBases=null}contextChange(){this._gpuBuffers=Object.create(null),this._gl=this._renderer.gl}getGlBuffer(e){return this._gpuBuffers[e.uid]||this.createGLBuffer(e)}bind(e){var t=this["_gl"],e=this.getGlBuffer(e);t.bindBuffer(e.type,e.buffer)}bindBufferBase(e,t){var r,s=this["_gl"];this._boundBufferBases[t]!==e&&(r=this.getGlBuffer(e),this._boundBufferBases[t]=e,s.bindBufferBase(s.UNIFORM_BUFFER,t,r.buffer))}bindBufferRange(e,t,r){var s=this["_gl"],e=(r=r||0,this.getGlBuffer(e));s.bindBufferRange(s.UNIFORM_BUFFER,t||0,e.buffer,256*r,256)}updateBuffer(e){var t,r=this["_gl"],s=this.getGlBuffer(e);return e._updateID!==s.updateID&&(s.updateID=e._updateID,r.bindBuffer(s.type,s.buffer),t=e.data,s.byteLength>=e.data.byteLength?r.bufferSubData(s.type,0,t,0,e._updateSize/t.BYTES_PER_ELEMENT):(e=e.descriptor.usage&T.S.STATIC?r.STATIC_DRAW:r.DYNAMIC_DRAW,s.byteLength=t.byteLength,r.bufferData(s.type,t,e))),s}destroyAll(){var e=this._gl;for(const t in this._gpuBuffers)e.deleteBuffer(this._gpuBuffers[t].buffer);this._gpuBuffers=Object.create(null)}onBufferDestroy(e,t){var r=this._gpuBuffers[e.uid],s=this._gl;t||s.deleteBuffer(r.buffer),this._gpuBuffers[e.uid]=null}createGLBuffer(e){var t=this["_gl"];let r=b.ARRAY_BUFFER;e.descriptor.usage&T.S.INDEX?r=b.ELEMENT_ARRAY_BUFFER:e.descriptor.usage&T.S.UNIFORM&&(r=b.UNIFORM_BUFFER);t=new w(t.createBuffer(),r);return this._gpuBuffers[e.uid]=t,e.on("destroy",this.onBufferDestroy,this),t}}k.extension={type:[e.Ag.WebGLSystem],name:"buffer"};var R=t(1761);const S=class S{constructor(e){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this._renderer=e,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this._renderer.gl=e}init(e){var t,r,s;(e={...S.defaultOptions,...e}).context?this.initFromContext(e.context):(t=this._renderer.background.alpha<1,r=e.premultipliedAlpha??!0,s=e.antialias&&!this._renderer.backBuffer.useBackBuffer,this.createContext(e.preferWebGLVersion,{alpha:t,premultipliedAlpha:r,antialias:s,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference??"default"}))}initFromContext(e){this.gl=e,this.webGLVersion=e instanceof R.e.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(e),this._renderer.runners.contextChange.emit(e);e=this._renderer.view.canvas;e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(e,t){let r;var s=this._renderer.view.canvas;if(!(r=2===e?s.getContext("webgl2",t):r)&&!(r=s.getContext("webgl",t)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=r,this.initFromContext(this.gl)}getExtensions(){var e=this["gl"],t={anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc"),rgtc:e.getExtension("EXT_texture_compression_rgtc"),loseContext:e.getExtension("WEBGL_lose_context")};1===this.webGLVersion?this.extensions={...t,drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:e.getExtension("ANGLE_instanced_arrays"),srgb:e.getExtension("EXT_sRGB")}:(this.extensions={...t,colorBufferFloat:e.getExtension("EXT_color_buffer_float")},(t=e.getExtension("WEBGL_provoking_vertex"))&&t.provokingVertexWEBGL(t.FIRST_VERTEX_CONVENTION_WEBGL))}handleContextLost(e){e.preventDefault(),this._contextLossForced&&(this._contextLossForced=!1,setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext?.restoreContext()},0))}handleContextRestored(){this._renderer.runners.contextChange.emit(this.gl)}destroy(){var e=this._renderer.view.canvas;this._renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext?.loseContext()}forceContextLoss(){this.extensions.loseContext?.loseContext(),this._contextLossForced=!0}validateContext(e){var e=e.getContextAttributes(),e=(e&&!e.stencil&&(0,d.R)("Provided WebGL context does not have a stencil buffer, masks may not render correctly"),this.supports),t=2===this.webGLVersion,r=this.extensions;e.uint32Indices=t||!!r.uint32ElementIndex,e.uniformBufferObject=t,e.vertexArrayObject=t||!!r.vertexArrayObject,e.srgbTextures=t||!!r.srgb,e.nonPowOf2wrapping=t,e.nonPowOf2mipmaps=t,e.msaa=t,e.uint32Indices||(0,d.R)("Provided WebGL context does not support 32 index buffer, large scenes may not render correctly")}};S.extension={type:[e.Ag.WebGLSystem],name:"context"},S.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2};var p=S,V=t(8306),X=t(7084),W=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))({}),Y=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))({}),x=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))({});const j={uint8x2:x.UNSIGNED_BYTE,uint8x4:x.UNSIGNED_BYTE,sint8x2:x.BYTE,sint8x4:x.BYTE,unorm8x2:x.UNSIGNED_BYTE,unorm8x4:x.UNSIGNED_BYTE,snorm8x2:x.BYTE,snorm8x4:x.BYTE,uint16x2:x.UNSIGNED_SHORT,uint16x4:x.UNSIGNED_SHORT,sint16x2:x.SHORT,sint16x4:x.SHORT,unorm16x2:x.UNSIGNED_SHORT,unorm16x4:x.UNSIGNED_SHORT,snorm16x2:x.SHORT,snorm16x4:x.SHORT,float16x2:x.HALF_FLOAT,float16x4:x.HALF_FLOAT,float32:x.FLOAT,float32x2:x.FLOAT,float32x3:x.FLOAT,float32x4:x.FLOAT,uint32:x.UNSIGNED_INT,uint32x2:x.UNSIGNED_INT,uint32x3:x.UNSIGNED_INT,uint32x4:x.UNSIGNED_INT,sint32:x.INT,sint32x2:x.INT,sint32x3:x.INT,sint32x4:x.INT};const K={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class z{constructor(e){this._geometryVaoHash=Object.create(null),this._renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0}contextChange(){var e=this.gl=this._renderer.gl;if(!this._renderer.context.supports.vertexArrayObject)throw new Error("[PixiJS] Vertex Array Objects are not supported on this device");const t=this._renderer.context.extensions.vertexArrayObject,n=(t&&(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=e=>t.bindVertexArrayOES(e),e.deleteVertexArray=e=>t.deleteVertexArrayOES(e)),this._renderer.context.extensions.vertexAttribDivisorANGLE);n&&(e.drawArraysInstanced=(e,t,r,s)=>{n.drawArraysInstancedANGLE(e,t,r,s)},e.drawElementsInstanced=(e,t,r,s,a)=>{n.drawElementsInstancedANGLE(e,t,r,s,a)},e.vertexAttribDivisor=(e,t)=>n.vertexAttribDivisorANGLE(e,t)),this._activeGeometry=null,this._activeVao=null,this._geometryVaoHash=Object.create(null)}bind(e,t){var r=this.gl,e=(this._activeGeometry=e,this.getVao(e,t));this._activeVao!==e&&(this._activeVao=e,r.bindVertexArray(e)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){var t=this._activeGeometry,r=this._renderer.buffer;for(let e=0;e<t.buffers.length;e++){var s=t.buffers[e];r.updateBuffer(s)}}checkCompatibility(e,t){var r=e.attributes;for(const s in t._attributeData)if(!r[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(e,t){var r=e.attributes,s=t._attributeData,a=["g",e.uid];for(const n in r)s[n]&&a.push(n,s[n].location);return a.join("-")}getVao(e,t){return this._geometryVaoHash[e.uid]?.[t._key]||this.initGeometryVao(e,t)}initGeometryVao(e,t,r=0){var s=this._renderer.gl,a=this._renderer.buffer,n=(this._renderer.shader._getProgramData(t),this.checkCompatibility(e,t),this.getSignature(e,t)),i=(this._geometryVaoHash[e.uid]||(this._geometryVaoHash[e.uid]=Object.create(null),e.on("destroy",this.onGeometryDestroy,this)),this._geometryVaoHash[e.uid]);if(u=i[n])return i[t._key]=u;(0,X.q)(e,t._attributeData);var o=e.buffers,u=s.createVertexArray();s.bindVertexArray(u);for(let e=0;e<o.length;e++){var c=o[e];a.bind(c)}return this.activateVao(e,t),i[t._key]=u,i[n]=u,s.bindVertexArray(null),u}onGeometryDestroy(e,t){var r=this._geometryVaoHash[e.uid],s=this.gl;if(r){if(t)for(const a in r)this._activeVao!==r[a]&&this.unbind(),s.deleteVertexArray(r[a]);this._geometryVaoHash[e.uid]=null}}destroyAll(e=!1){var t=this.gl;for(const s in this._geometryVaoHash){if(e)for(const a in this._geometryVaoHash[s]){var r=this._geometryVaoHash[s];this._activeVao!==r&&this.unbind(),t.deleteVertexArray(r[a])}this._geometryVaoHash[s]=null}}activateVao(e,t){var r=this._renderer.gl,s=this._renderer.buffer,a=e.attributes;e.indexBuffer&&s.bind(e.indexBuffer);let n=null;for(const l in a){var i=a[l],o=i.buffer,u=s.getGlBuffer(o),c=t._attributeData[l];if(c){n!==u&&(s.bind(o),n=u);var o=i.location,u=(r.enableVertexAttribArray(o),(0,V.m)(i.format)),_=(_=i.format,j[_]??j.float32);if("int"===c.format?.substring(1,4)?r.vertexAttribIPointer(o,u.size,_,i.stride,i.offset):r.vertexAttribPointer(o,u.size,_,u.normalised,i.stride,i.offset),i.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(o,1)}}}}draw(e,t,r,s){var a,n,i=this._renderer["gl"],o=this._activeGeometry,e=K[o.topology||e];return s=s||o.instanceCount,o.indexBuffer?(n=2===(a=o.indexBuffer.data.BYTES_PER_ELEMENT)?i.UNSIGNED_SHORT:i.UNSIGNED_INT,1<s?i.drawElementsInstanced(e,t||o.indexBuffer.data.length,n,(r||0)*a,s):i.drawElements(e,t||o.indexBuffer.data.length,n,(r||0)*a)):1<s?i.drawArraysInstanced(e,r||0,t||o.getSize(),s):i.drawArrays(e,r||0,t||o.getSize()),this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}}z.extension={type:[e.Ag.WebGLSystem],name:"geometry"};var A=t(6011),$=t(6932),q=t(9114);const Z=new A.V({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),B=class B{constructor(e){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=e}init(e={}){var{useBackBuffer:e,antialias:t}={...B.defaultOptions,...e},e=(this.useBackBuffer=e,this._antialias=t,this._renderer.context.supports.msaa||((0,d.R)("antialiasing, is not supported on when using the back buffer"),this._antialias=!1),this._state=m.U.for2d(),new q.M({vertex:`
                attribute vec2 aPosition;
                out vec2 vUv;

                void main() {
                    gl_Position = vec4(aPosition, 0.0, 1.0);

                    vUv = (aPosition + 1.0) / 2.0;

                    // flip dem UVs
                    vUv.y = 1.0 - vUv.y;
                }`,fragment:`
                in vec2 vUv;
                out vec4 finalColor;

                uniform sampler2D uTexture;

                void main() {
                    finalColor = texture(uTexture, vUv);
                }`,name:"big-triangle"}));this._bigTriangleShader=new _.M({glProgram:e,resources:{uTexture:h.g.WHITE.source}})}renderStart(e){var t=this._renderer.renderTarget.getRenderTarget(e.target);this._useBackBufferThisRender=this.useBackBuffer&&!!t.isRoot,this._useBackBufferThisRender&&(t=this._renderer.renderTarget.getRenderTarget(e.target),this._targetTexture=t.colorTexture,e.target=this._getBackBufferTexture(t.colorTexture))}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){var e=this._renderer;e.renderTarget.finishRenderPass(),this._useBackBufferThisRender&&(e.renderTarget.bind(this._targetTexture,!1),this._bigTriangleShader.resources.uTexture=this._backBufferTexture.source,e.encoder.draw({geometry:Z,shader:this._bigTriangleShader,state:this._state}))}_getBackBufferTexture(e){return this._backBufferTexture=this._backBufferTexture||new h.g({source:new $.v({width:e.width,height:e.height,resolution:e._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(e.width,e.height,e._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};B.extension={type:[e.Ag.WebGLSystem],name:"backBuffer",priority:1},B.defaultOptions={useBackBuffer:!1};A=B;class Q{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.gl.colorMask(!!(8&e),!!(4&e),!!(2&e),!!(1&e)))}}Q.extension={type:[e.Ag.WebGLSystem],name:"colorMask"};class J{constructor(e){this.commandFinished=Promise.resolve(),this._renderer=e}setGeometry(e,t){this._renderer.geometry.bind(e,t.glProgram)}finishRenderPass(){}draw(e){var t=this._renderer,{geometry:e,shader:r,state:s,skipSync:a,topology:n,size:i,start:o,instanceCount:u}=e;t.shader.bind(r,a),t.geometry.bind(e,t.shader._activeProgram),s&&t.state.set(s),t.geometry.draw(n,i,o,u??e.instanceCount)}destroy(){this._renderer=null}}J.extension={type:[e.Ag.WebGLSystem],name:"encoder"};var ee=t(1172),N=t(1957);class te{constructor(e){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:N.K.NONE},this._renderTargetStencilState=Object.create(null),e.renderTarget.onRenderTargetChange.add(this)}contextChange(e){this._gl=e,this._comparisonFuncMapping={always:e.ALWAYS,never:e.NEVER,equal:e.EQUAL,"not-equal":e.NOTEQUAL,less:e.LESS,"less-equal":e.LEQUAL,greater:e.GREATER,"greater-equal":e.GEQUAL},this._stencilOpsMapping={keep:e.KEEP,zero:e.ZERO,replace:e.REPLACE,invert:e.INVERT,"increment-clamp":e.INCR,"decrement-clamp":e.DECR,"increment-wrap":e.INCR_WRAP,"decrement-wrap":e.DECR_WRAP},this._stencilCache.enabled=!1,this._stencilCache.stencilMode=N.K.NONE,this._stencilCache.stencilReference=0}onRenderTargetChange(t){if(this._activeRenderTarget!==t){this._activeRenderTarget=t;let e=this._renderTargetStencilState[t.uid];e=e||(this._renderTargetStencilState[t.uid]={stencilMode:N.K.DISABLED,stencilReference:0}),this.setStencilMode(e.stencilMode,e.stencilReference)}}setStencilMode(e,t){var r=this._renderTargetStencilState[this._activeRenderTarget.uid],s=this._gl,a=ee.g[e],n=this._stencilCache;r.stencilMode=e,r.stencilReference=t,e===N.K.DISABLED?this._stencilCache.enabled&&(this._stencilCache.enabled=!1,s.disable(s.STENCIL_TEST)):(this._stencilCache.enabled||(this._stencilCache.enabled=!0,s.enable(s.STENCIL_TEST)),e===n.stencilMode&&n.stencilReference===t||(n.stencilMode=e,n.stencilReference=t,s.stencilFunc(this._comparisonFuncMapping[a.stencilBack.compare],t,255),s.stencilOp(s.KEEP,s.KEEP,this._stencilOpsMapping[a.stencilBack.passOp])))}}te.extension={type:[e.Ag.WebGLSystem],name:"stencil"};var G=t(7047);const re={f32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"mat2x2<f32>":32,"mat3x3<f32>":48,"mat4x4<f32>":64};function se(e){var t=e.map(e=>({data:e,offset:0,size:0}));let r=0,s=0,a=0;for(let e=0;e<t.length;e++){var n,i=t[e];if(!(r=re[i.data.type]))throw new Error("Unknown type "+i.data.type);1<i.data.size&&(r=Math.max(r,16)*i.data.size),i.size=r,s%r!=0&&s<16&&(n=s%r%16,s+=n,a+=n),16<s+r?(a=16*Math.ceil(a/16),i.offset=a,a+=r,s=r):(i.offset=a,s+=r,a+=r)}return{uboElements:t,size:a=16*Math.ceil(a/16)}}var ae=t(6423),ne=t(1266);function ie(e,t){var r=Math.max(re[e.data.type]/16,1),s=e.data.value.length/e.data.size,a=(4-s%4)%4;return`
        v = uv.${e.data.name};
        offset += ${t};

        arrayOffset = offset;

        t = 0;

        for(var i=0; i < ${e.data.size*r}; i++)
        {
            for(var j = 0; j < ${s}; j++)
            {
                data[arrayOffset++] = v[t++];
            }
            ${0!=a?`arrayOffset += ${a};`:""}
        }
    `}function oe(e){return(0,ae.E)(e,"uboStd40",ie,ne.g)}class ue extends G.W{constructor(){super({createUboElements:se,generateUboSync:oe})}}ue.extension={type:[e.Ag.WebGLSystem],name:"ubo"};var G=t(7238),ce=t(9252),I=t(1257);class _e{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}class le{constructor(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new ce.M}init(e,t){this._renderer=e,this._renderTargetSystem=t,e.runners.contextChange.add(this)}contextChange(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new ce.M}copyToTexture(e,t,r,s,a){var n=this._renderTargetSystem,i=this._renderer,n=n.getGpuRenderTarget(e),o=i.gl;return this.finishRenderPass(e),o.bindFramebuffer(o.FRAMEBUFFER,n.resolveTargetFramebuffer),i.texture.bind(t,0),o.copyTexSubImage2D(o.TEXTURE_2D,0,a.x,a.y,r.x,r.y,s.width,s.height),t}startRenderPass(e,t=!0,r,s){var a=this._renderTargetSystem,n=e.colorTexture,a=a.getGpuRenderTarget(e);let i=s.y;e.isRoot&&(i=n.pixelHeight-s.height),e.colorTextures.forEach(e=>{this._renderer.texture.unbind(e)});var n=this._renderer.gl,o=(n.bindFramebuffer(n.FRAMEBUFFER,a.framebuffer),this._viewPortCache);o.x===s.x&&o.y===i&&o.width===s.width&&o.height===s.height||(o.x=s.x,o.y=i,o.width=s.width,o.height=s.height,n.viewport(s.x,i,s.width,s.height)),a.depthStencilRenderBuffer||!e.stencil&&!e.depth||this._initStencil(a),this.clear(e,t,r)}finishRenderPass(e){var t,e=this._renderTargetSystem.getGpuRenderTarget(e);e.msaa&&((t=this._renderer.gl).bindFramebuffer(t.FRAMEBUFFER,e.resolveTargetFramebuffer),t.bindFramebuffer(t.READ_FRAMEBUFFER,e.framebuffer),t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,t.COLOR_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,e.framebuffer))}initGpuRenderTarget(e){var t=this._renderer,r=t.gl,s=new _e;return e.colorTexture.resource===t.gl.canvas?s.framebuffer=null:(this._initColor(e,s),r.bindFramebuffer(r.FRAMEBUFFER,null)),s}destroyGpuRenderTarget(e){const t=this._renderer.gl;e.framebuffer&&(t.deleteFramebuffer(e.framebuffer),e.framebuffer=null),e.resolveTargetFramebuffer&&(t.deleteFramebuffer(e.resolveTargetFramebuffer),e.resolveTargetFramebuffer=null),e.depthStencilRenderBuffer&&(t.deleteRenderbuffer(e.depthStencilRenderBuffer),e.depthStencilRenderBuffer=null),e.msaaRenderBuffer.forEach(e=>{t.deleteRenderbuffer(e)}),e.msaaRenderBuffer=null}clear(e,t,r){var s,a;t&&(a=this._renderTargetSystem,"boolean"==typeof t&&(t=t?I.u.ALL:I.u.NONE),s=this._renderer.gl,t&I.u.COLOR&&(a=r=r??a.defaultClearColor,(r=this._clearColorCache)[0]===a[0]&&r[1]===a[1]&&r[2]===a[2]&&r[3]===a[3]||(r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],s.clearColor(a[0],a[1],a[2],a[3]))),s.clear(t))}resizeGpuRenderTarget(e){var t;e.isRoot||(t=this._renderTargetSystem.getGpuRenderTarget(e),this._resizeColor(e,t),e.stencil&&this._resizeStencil(t))}_initColor(e,s){const r=this._renderer,a=r.gl;var t,n=a.createFramebuffer();s.resolveTargetFramebuffer=n,a.bindFramebuffer(a.FRAMEBUFFER,n),s.width=e.colorTexture.source.pixelWidth,s.height=e.colorTexture.source.pixelHeight,e.colorTextures.forEach((e,t)=>{e=e.source,e.antialias&&(r.context.supports.msaa?s.msaa=!0:(0,d.R)("[RenderTexture] Antialiasing on textures is not supported in WebGL1")),r.texture.bindSource(e,0),e=r.texture.getGlSource(e),e=e.texture;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+t,3553,e,0)}),s.msaa?(t=a.createFramebuffer(),s.framebuffer=t,a.bindFramebuffer(a.FRAMEBUFFER,t),e.colorTextures.forEach((e,t)=>{var r=a.createRenderbuffer();s.msaaRenderBuffer[t]=r})):s.framebuffer=n,this._resizeColor(e,s)}_resizeColor(e,a){const r=e.colorTexture.source;if(a.width=r.pixelWidth,a.height=r.pixelHeight,e.colorTextures.forEach((e,t)=>{0!==t&&e.source.resize(r.width,r.height,r._resolution)}),a.msaa){const n=this._renderer,i=n.gl;var t=a.framebuffer;i.bindFramebuffer(i.FRAMEBUFFER,t),e.colorTextures.forEach((e,t)=>{var e=e.source,r=(n.texture.bindSource(e,0),n.texture.getGlSource(e)),r=r.internalFormat,s=a.msaaRenderBuffer[t];i.bindRenderbuffer(i.RENDERBUFFER,s),i.renderbufferStorageMultisample(i.RENDERBUFFER,4,r,e.pixelWidth,e.pixelHeight),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+t,i.RENDERBUFFER,s)})}}_initStencil(e){var t,r;null!==e.framebuffer&&(r=(t=this._renderer.gl).createRenderbuffer(),e.depthStencilRenderBuffer=r,t.bindRenderbuffer(t.RENDERBUFFER,r),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,r),this._resizeStencil(e))}_resizeStencil(e){var t=this._renderer.gl;t.bindRenderbuffer(t.RENDERBUFFER,e.depthStencilRenderBuffer),e.msaa?t.renderbufferStorageMultisample(t.RENDERBUFFER,4,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,2===this._renderer.context.webGLVersion?t.DEPTH24_STENCIL8:t.DEPTH_STENCIL,e.width,e.height)}}class he extends G.l{constructor(e){super(e),this.adaptor=new le,this.adaptor.init(e,this)}}he.extension={type:[e.Ag.WebGLSystem],name:"renderTarget"};var de=t(581);class ge{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function fe(e,t,r){t=e.createShader(t);return e.shaderSource(t,r),e.compileShader(t),t}function C(e){var t=new Array(e);for(let e=0;e<t.length;e++)t[e]=!1;return t}function me(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return C(2*t);case"bvec3":return C(3*t);case"bvec4":return C(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}let D=null;const Ee={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},ve={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"};function Te(t,e){if(!D){var r=Object.keys(Ee);D={};for(let e=0;e<r.length;++e){var s=r[e];D[t[s]]=Ee[s]}}return D[e]}function be(t,r,e=!1){var s,a={},n=r.getProgramParameter(t,r.ACTIVE_ATTRIBUTES);for(let e=0;e<n;e++){var i,o=r.getActiveAttrib(t,e);o.name.startsWith("gl_")||(s=r,i=o.type,s=Te(r,i),i=ve[s]||"float32",a[o.name]={location:0,format:i,stride:(0,V.m)(i).stride,offset:0,instance:!1,start:0})}var u=Object.keys(a);if(e){u.sort((e,t)=>t<e?1:-1);for(let e=0;e<u.length;e++)a[u[e]].location=e,r.bindAttribLocation(t,e,u[e]);r.linkProgram(t)}else for(let e=0;e<u.length;e++)a[u[e]].location=r.getAttribLocation(t,u[e]);return a}function Re(e,t){const r=e.getShaderSource(t).split("\n").map((e,t)=>t+": "+e);e=e.getShaderInfoLog(t),t=e.split("\n");const s={};t=t.map(e=>parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(e=>!(!e||s[e])&&(s[e]=!0));const a=[""];t.forEach(e=>{r[e-1]=`%c${r[e-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});t=r.join("\n");a[0]=t,console.error(e),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Se(e,t){var r,s,a,n=fe(e,e.VERTEX_SHADER,t.vertex),i=fe(e,e.FRAGMENT_SHADER,t.fragment),o=e.createProgram(),u=(e.attachShader(o,n),e.attachShader(o,i),t.transformFeedbackVaryings),c=(u&&("function"!=typeof e.transformFeedbackVaryings?(0,d.R)("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(o,u.names,"separate"===u.bufferMode?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||(u=o,s=n,a=i,(r=e).getProgramParameter(u,r.LINK_STATUS))||(r.getShaderParameter(s,r.COMPILE_STATUS)||Re(r,s),r.getShaderParameter(a,r.COMPILE_STATUS)||Re(r,a),console.error("PixiJS Error: Could not initialize shader."),""!==r.getProgramInfoLog(u)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(u))),t._attributeData=be(o,e,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertex)),t._uniformData=function(t,r){var s={},a=r.getProgramParameter(t,r.ACTIVE_UNIFORMS);for(let e=0;e<a;e++){var n=r.getActiveUniform(t,e),i=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),u=Te(r,n.type);s[i]={name:i,index:e,type:u,size:n.size,isArray:o,value:me(u,n.size)}}return s}(o,e),t._uniformBlockData=function(t,r){if(!r.ACTIVE_UNIFORM_BLOCKS)return{};var s={},a=r.getProgramParameter(t,r.ACTIVE_UNIFORM_BLOCKS);for(let e=0;e<a;e++){var n=r.getActiveUniformBlockName(t,e),i=r.getUniformBlockIndex(t,n),o=r.getActiveUniformBlockParameter(t,e,r.UNIFORM_BLOCK_DATA_SIZE);s[n]={name:n,index:i,size:o}}return s}(o,e),e.deleteShader(n),e.deleteShader(i),{});for(const l in t._uniformData){var _=t._uniformData[l];c[l]={location:e.getUniformLocation(o,l),value:me(_.type,_.size)}}return new ge(o,c)}const U={textureCount:0,blockIndex:0};class pe{constructor(e){this._activeProgram=null,this._programDataHash=Object.create(null),this._nextIndex=0,this._boundUniformsIdsToIndexHash=Object.create(null),this._boundIndexToUniformsHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._renderer=e}contextChange(e){this._gl=e,this._maxBindings=e.MAX_UNIFORM_BUFFER_BINDINGS?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0,this._programDataHash=Object.create(null),this._boundUniformsIdsToIndexHash=Object.create(null),this._boundIndexToUniformsHash=Object.create(null),this._activeProgram=null}bind(t,e){if(this._setProgram(t.glProgram),!e){U.textureCount=0,U.blockIndex=0;let e=this._shaderSyncFunctions[t.glProgram._key];(e=e||(this._shaderSyncFunctions[t.glProgram._key]=this._generateShaderSync(t,this)))(this._renderer,t,U)}}updateUniformGroup(e){this._renderer.uniformGroup.updateUniformGroup(e,this._activeProgram,U)}bindUniformBlock(e,t,r=0){var s,a=this._renderer.buffer,n=this._getProgramData(this._activeProgram),i=e._bufferResource;i&&this._renderer.ubo.updateUniformGroup(e),a.updateBuffer(e.buffer);let o=this._boundUniformsIdsToIndexHash[e.uid];void 0===o&&(s=this._nextIndex++%this._maxBindings,(u=this._boundIndexToUniformsHash[s])&&(this._boundUniformsIdsToIndexHash[u.uid]=void 0),o=this._boundUniformsIdsToIndexHash[e.uid]=s,this._boundIndexToUniformsHash[s]=e,i?a.bindBufferRange(e.buffer,s,e.offset):a.bindBufferBase(e.buffer,s));var u=this._gl,i=this._activeProgram._uniformBlockData[t].index;n.uniformBlockBindings[r]!==o&&(n.uniformBlockBindings[r]=o,u.uniformBlockBinding(n.program,i,o))}_setProgram(e){this._activeProgram!==e&&(this._activeProgram=e,e=this._getProgramData(e),this._gl.useProgram(e.program))}_getProgramData(e){return this._programDataHash[e._key]||this._createProgramData(e)}_createProgramData(e){var t=e._key;return this._programDataHash[t]=Se(this._gl,e),this._programDataHash[t]}destroy(){for(const e of Object.keys(this._programDataHash))this._programDataHash[e].destroy(),this._programDataHash[e]=null;this._programDataHash=null,this._boundUniformsIdsToIndexHash=null}_generateShaderSync(s,a){{var n=s,i=a,o=[],u=[`
        var g = s.groups;
        var sS = r.shader;
        var p = s.glProgram;
        var ugS = r.uniformGroup;
        var resources;
    `];let e=!1,t=0,r=0;var c=i._getProgramData(n.glProgram);for(const h in n.groups){var _=n.groups[h];o.push(`
            resources = g[${h}].resources;
        `);for(const d in _.resources){var l=_.resources[d];l instanceof g.k?l.ubo?o.push(`
                        sS.bindUniformBlock(
                            resources[${d}],
                            sS._uniformBindMap[${h}[${d}],
                            ${t++}
                        );
                    `):o.push(`
                        ugS.updateUniformGroup(resources[${d}], p, sD);
                    `):l instanceof de.d?o.push(`
                    sS.bindUniformBlock(
                        resources[${d}],
                        sS._uniformBindMap[${h}[${d}],
                        ${t++}
                    );
                `):l instanceof $.v&&(l=n._uniformBindMap[h][d],l=c.uniformData[l])&&(e||(e=!0,u.push(`
                        var tS = r.texture;
                        `)),i._gl.uniform1i(l.location,r),o.push(`
                        tS.bind(resources[${d}], ${r});
                    `),r++)}}return s=[...u,...o].join("\n"),new Function("r","s","sD",s)}}}pe.extension={type:[e.Ag.WebGLSystem],name:"shader"};var y=t(8166);const xe={f32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1f(location, v);
        }`,"vec2<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2f(location, v[0], v[1]);
        }`,"vec3<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3f(location, v[0], v[1], v[2]);
        }`,"vec4<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4f(location, v[0], v[1], v[2], v[3]);
        }`,i32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,u32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1ui(location, v);
        }`,"vec2<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2ui(location, v[0], v[1]);
        }`,"vec3<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3ui(location, v[0], v[1], v[2]);
        }`,"vec4<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
        }`,bool:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,"mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},Ae={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"};function Be(e,t){var r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
        var name = null;
    `];for(const i in e.uniforms)if(t[i]){var s,a=e.uniformStructures[i];let t=!1;for(let e=0;e<y.$.length;e++){var n=y.$[e];if(a.type===n.type&&n.test(a)){r.push(`name = "${i}";`,y.$[e].uniform),t=!0;break}}t||(s=(1===a.size?xe:Ae)[a.type].replace("location",`ud["${i}"].location`),r.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${s};`))}else e.uniforms[i]instanceof g.k?e.uniforms[i].ubo?r.push(`
                        renderer.shader.bindUniformBlock(uv.${i}, "${i}");
                    `):r.push(`
                        renderer.shader.updateUniformGroup(uv.${i});
                    `):e.uniforms[i]instanceof de.d&&r.push(`
                        renderer.shader.bindBufferResource(uv.${i}, "${i}");
                    `);return new Function("ud","uv","renderer","syncData",r.join("\n"))}class Ne{constructor(e){this._cache={},this._uniformGroupSyncHash={},this._renderer=e,this.gl=null,this._cache={}}contextChange(e){this.gl=e}updateUniformGroup(e,t,r){var s=this._renderer.shader._getProgramData(t);e.isStatic&&e._dirtyId===s.uniformDirtyGroups[e.uid]||(s.uniformDirtyGroups[e.uid]=e._dirtyId,this._getUniformSyncFunction(e,t)(s.uniformData,e.uniforms,this._renderer,r))}_getUniformSyncFunction(e,t){return this._uniformGroupSyncHash[e._signature]?.[t._key]||this._createUniformSyncFunction(e,t)}_createUniformSyncFunction(e,t){var r=this._uniformGroupSyncHash[e._signature]||(this._uniformGroupSyncHash[e._signature]={}),s=this._getSignature(e,t._uniformData,"u");return this._cache[s]||(this._cache[s]=this._generateUniformsSync(e,t._uniformData)),r[t._key]=this._cache[s],r[t._key]}_generateUniformsSync(e,t){return Be(e,t)}_getSignature(e,t,r){var s=[r+"-"];for(const a in e.uniforms)s.push(a),t[a]&&s.push(t[a].type);return s.join("-")}destroy(){this._renderer=null,this._cache=null}}Ne.extension={type:[e.Ag.WebGLSystem],name:"uniformGroup"};const O=class O{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=m.U.for2d()}contextChange(e){var t;this.gl=e,this.blendModesMap=((t={}).normal=[(e=e).ONE,e.ONE_MINUS_SRC_ALPHA],t.add=[e.ONE,e.ONE],t.multiply=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t.screen=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t.none=[0,0],t["normal-npm"]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t["add-npm"]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t["screen-npm"]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t.erase=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t),this.reset()}set(r){if(r=r||this.defaultState,this.stateId!==r.data){let e=this.stateId^r.data,t=0;for(;e;)1&e&&this.map[t].call(this,!!(r.data&1<<t)),e>>=1,t++;this.stateId=r.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,r)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(e){this._updateCheck(O._checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this._updateCheck(O._checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){var t;(e=this.blendModesMap[e]?e:"normal")!==this.blendMode&&(this.blendMode=e,e=this.blendModesMap[e],t=this.gl,2===e.length?t.blendFunc(e[0],e[1]):t.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,t.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD)))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(e,t){var r=this.checks.indexOf(e);t&&-1===r?this.checks.push(e):t||-1===r||this.checks.splice(r,1)}static _checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static _checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};O.extension={type:[e.Ag.WebGLSystem],name:"state"};G=O;class Ge{constructor(e){this.target=Y.TEXTURE_2D,this.texture=e,this.width=-1,this.height=-1,this.type=x.UNSIGNED_BYTE,this.internalFormat=W.RGBA,this.format=W.RGBA,this.samplerType=0}}const Ie={id:"image",upload(e,t,r){t.width===e.width||t.height===e.height?r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.format,t.type,e.resource):r.texImage2D(t.target,0,t.internalFormat,e.width,e.height,0,t.format,t.type,e.resource),t.width=e.width,t.height=e.height}},Ce={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},De={id:"compressed",upload(t,r,s){s.pixelStorei(s.UNPACK_ALIGNMENT,4);let a=t.pixelWidth,n=t.pixelHeight;var i=!!Ce[t.format];for(let e=0;e<t.resource.length;e++){var o=t.resource[e];i?s.compressedTexImage2D(s.TEXTURE_2D,e,r.internalFormat,a,n,0,o):s.texImage2D(s.TEXTURE_2D,e,r.internalFormat,a,n,0,r.format,r.type,o),a=Math.max(a>>1,1),n=Math.max(n>>1,1)}}},Ue={id:"image",upload(e,t,r,s){var a="premultiply-alpha-on-upload"===e.alphaMode,a=(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),t.width),n=t.height,i=e.pixelWidth,o=e.pixelHeight,u=e.resourceWidth,c=e.resourceHeight;u<i||c<o?(a===i&&n===o||r.texImage2D(t.target,0,t.internalFormat,i,o,0,t.format,t.type,null),2===s?r.texSubImage2D(r.TEXTURE_2D,0,0,0,u,c,t.format,t.type,e.resource):r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.format,t.type,e.resource)):a===i||n===o?r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.format,t.type,e.resource):2===s?r.texImage2D(t.target,0,t.internalFormat,i,o,0,t.format,t.type,e.resource):r.texImage2D(t.target,0,t.internalFormat,t.format,t.type,e.resource),t.width=i,t.height=o}},ye={id:"video",upload(e,t,r,s){e.isValid?Ue.upload(e,t,r,s):r.texImage2D(t.target,0,t.internalFormat,1,1,0,t.format,t.type,null)}},Oe={linear:9729,nearest:9728},Pe={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},P={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},Fe={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function Le(e,t,r,s,a,n,i,o){var u,c;o&&"repeat"===e.addressModeU&&"repeat"===e.addressModeV&&"repeat"===e.addressModeW||(u=P[i?"clamp-to-edge":e.addressModeU],c=P[i?"clamp-to-edge":e.addressModeV],i=P[i?"clamp-to-edge":e.addressModeW],t[a](n,t.TEXTURE_WRAP_S,u),t[a](n,t.TEXTURE_WRAP_T,c),t.TEXTURE_WRAP_R&&t[a](n,t.TEXTURE_WRAP_R,i)),o&&"linear"===e.magFilter||t[a](n,t.TEXTURE_MAG_FILTER,Oe[e.magFilter]),r?o&&"linear"===e.mipmapFilter||(u=Pe[e.minFilter][e.mipmapFilter],t[a](n,t.TEXTURE_MIN_FILTER,u)):t[a](n,t.TEXTURE_MIN_FILTER,Oe[e.minFilter]),s&&1<e.maxAnisotropy&&(c=Math.min(e.maxAnisotropy,t.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),t[a](n,s.TEXTURE_MAX_ANISOTROPY_EXT,c)),e.compare&&t[a](n,t.TEXTURE_COMPARE_FUNC,Fe[e.compare])}class Me{constructor(e){this.managedTextures=[],this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:Ue,buffer:Ie,video:ye,compressed:De},this._useSeparateSamplers=!1,this._renderer=e}contextChange(e){this._gl=e,this._mapFormatToInternalFormat||(this._mapFormatToInternalFormat=function(e,t){let r={},s=e.RGBA;return e instanceof R.e.get().getWebGLRenderingContext()?t.srgb&&(r={"rgba8unorm-srgb":t.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":t.srgb.SRGB8_ALPHA8_EXT}):(r={"rgba8unorm-srgb":e.SRGB8_ALPHA8,"bgra8unorm-srgb":e.SRGB8_ALPHA8},s=e.RGBA8),{r8unorm:e.R8,r8snorm:e.R8_SNORM,r8uint:e.R8UI,r8sint:e.R8I,r16uint:e.R16UI,r16sint:e.R16I,r16float:e.R16F,rg8unorm:e.RG8,rg8snorm:e.RG8_SNORM,rg8uint:e.RG8UI,rg8sint:e.RG8I,r32uint:e.R32UI,r32sint:e.R32I,r32float:e.R32F,rg16uint:e.RG16UI,rg16sint:e.RG16I,rg16float:e.RG16F,rgba8unorm:e.RGBA,...r,rgba8snorm:e.RGBA8_SNORM,rgba8uint:e.RGBA8UI,rgba8sint:e.RGBA8I,bgra8unorm:s,rgb9e5ufloat:e.RGB9_E5,rgb10a2unorm:e.RGB10_A2,rg11b10ufloat:e.R11F_G11F_B10F,rg32uint:e.RG32UI,rg32sint:e.RG32I,rg32float:e.RG32F,rgba16uint:e.RGBA16UI,rgba16sint:e.RGBA16I,rgba16float:e.RGBA16F,rgba32uint:e.RGBA32UI,rgba32sint:e.RGBA32I,rgba32float:e.RGBA32F,stencil8:e.STENCIL_INDEX8,depth16unorm:e.DEPTH_COMPONENT16,depth24plus:e.DEPTH_COMPONENT24,"depth24plus-stencil8":e.DEPTH24_STENCIL8,depth32float:e.DEPTH_COMPONENT32F,"depth32float-stencil8":e.DEPTH32F_STENCIL8,...t.s3tc?{"bc1-rgba-unorm":t.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":t.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":t.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...t.s3tc_sRGB?{"bc1-rgba-unorm-srgb":t.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":t.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":t.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...t.rgtc?{"bc4-r-unorm":t.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":t.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":t.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":t.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{},...t.bptc?{"bc6h-rgb-float":t.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":t.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":t.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":t.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...t.etc?{"etc2-rgb8unorm":t.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":t.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":t.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":t.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":t.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":t.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":t.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":t.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...t.astc?{"astc-4x4-unorm":t.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":t.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":t.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":t.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":t.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":t.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":t.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}}(e,this._renderer.context.extensions),this._mapFormatToType={r8unorm:e.UNSIGNED_BYTE,r8snorm:e.BYTE,r8uint:e.UNSIGNED_BYTE,r8sint:e.BYTE,r16uint:e.UNSIGNED_SHORT,r16sint:e.SHORT,r16float:e.HALF_FLOAT,rg8unorm:e.UNSIGNED_BYTE,rg8snorm:e.BYTE,rg8uint:e.UNSIGNED_BYTE,rg8sint:e.BYTE,r32uint:e.UNSIGNED_INT,r32sint:e.INT,r32float:e.FLOAT,rg16uint:e.UNSIGNED_SHORT,rg16sint:e.SHORT,rg16float:e.HALF_FLOAT,rgba8unorm:e.UNSIGNED_BYTE,"rgba8unorm-srgb":e.UNSIGNED_BYTE,rgba8snorm:e.BYTE,rgba8uint:e.UNSIGNED_BYTE,rgba8sint:e.BYTE,bgra8unorm:e.UNSIGNED_BYTE,"bgra8unorm-srgb":e.UNSIGNED_BYTE,rgb9e5ufloat:e.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:e.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:e.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:e.UNSIGNED_INT,rg32sint:e.INT,rg32float:e.FLOAT,rgba16uint:e.UNSIGNED_SHORT,rgba16sint:e.SHORT,rgba16float:e.HALF_FLOAT,rgba32uint:e.UNSIGNED_INT,rgba32sint:e.INT,rgba32float:e.FLOAT,stencil8:e.UNSIGNED_BYTE,depth16unorm:e.UNSIGNED_SHORT,depth24plus:e.UNSIGNED_INT,"depth24plus-stencil8":e.UNSIGNED_INT_24_8,depth32float:e.FLOAT,"depth32float-stencil8":e.FLOAT_32_UNSIGNED_INT_24_8_REV},this._mapFormatToFormat={r8unorm:e.RED,r8snorm:e.RED,r8uint:e.RED,r8sint:e.RED,r16uint:e.RED,r16sint:e.RED,r16float:e.RED,rg8unorm:e.RG,rg8snorm:e.RG,rg8uint:e.RG,rg8sint:e.RG,r32uint:e.RED,r32sint:e.RED,r32float:e.RED,rg16uint:e.RG,rg16sint:e.RG,rg16float:e.RG,rgba8unorm:e.RGBA,"rgba8unorm-srgb":e.RGBA,rgba8snorm:e.RGBA,rgba8uint:e.RGBA,rgba8sint:e.RGBA,bgra8unorm:e.RGBA,"bgra8unorm-srgb":e.RGBA,rgb9e5ufloat:e.RGB,rgb10a2unorm:e.RGBA,rg11b10ufloat:e.RGB,rg32uint:e.RG,rg32sint:e.RG,rg32float:e.RG,rgba16uint:e.RGBA,rgba16sint:e.RGBA,rgba16float:e.RGBA,rgba32uint:e.RGBA,rgba32sint:e.RGBA,rgba32float:e.RGBA,stencil8:e.STENCIL_INDEX8,depth16unorm:e.DEPTH_COMPONENT,depth24plus:e.DEPTH_COMPONENT,"depth24plus-stencil8":e.DEPTH_STENCIL,depth32float:e.DEPTH_COMPONENT,"depth32float-stencil8":e.DEPTH_STENCIL}),this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundSamplers=Object.create(null);for(let e=0;e<16;e++)this.bind(h.g.EMPTY,e)}initSource(e){this.bind(e)}bind(e,t=0){var r=e.source;e?(this.bindSource(r,t),this._useSeparateSamplers&&this._bindSampler(r.style,t)):(this.bindSource(null,t),this._useSeparateSamplers&&this._bindSampler(null,t))}bindSource(e,t=0){var r=this._gl;e._touched=this._renderer.textureGC.count,this._boundTextures[t]!==e&&(this._boundTextures[t]=e,this._activateLocation(t),e=e||h.g.EMPTY.source,t=this.getGlSource(e),r.bindTexture(t.target,t.texture))}_bindSampler(e,t=0){var r=this._gl;e?(e=this._getGlSampler(e),this._boundSamplers[t]!==e&&(this._boundSamplers[t]=e,r.bindSampler(t,e))):(this._boundSamplers[t]=null,r.bindSampler(t,null))}unbind(e){var t,r=e.source,s=this._boundTextures,a=this._gl;for(let e=0;e<s.length;e++)s[e]===r&&(this._activateLocation(e),t=this.getGlSource(r),a.bindTexture(t.target,null),s[e]=null)}_activateLocation(e){this._activeTextureLocation!==e&&(this._activeTextureLocation=e,this._gl.activeTexture(this._gl.TEXTURE0+e))}_initSource(e){var t,r=this._gl,r=new Ge(r.createTexture());return r.type=this._mapFormatToType[e.format],r.internalFormat=this._mapFormatToInternalFormat[e.format],r.format=this._mapFormatToFormat[e.format],e.autoGenerateMipmaps&&(this._renderer.context.supports.nonPowOf2mipmaps||e.isPowerOfTwo)&&(t=Math.max(e.width,e.height),e.mipLevelCount=Math.floor(Math.log2(t))+1),this._glTextures[e.uid]=r,this.managedTextures.includes(e)||(e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceUpdate,this),e.on("styleChange",this.onStyleChange,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),e.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(e)),this.onSourceUpdate(e),this.updateStyle(e,!1),r}onStyleChange(e){this.updateStyle(e,!1)}updateStyle(e,t){var r=this._gl,s=this.getGlSource(e);r.bindTexture(r.TEXTURE_2D,s.texture),Le((this._boundTextures[this._activeTextureLocation]=e).style,r,1<e.mipLevelCount,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",r.TEXTURE_2D,!this._renderer.context.supports.nonPowOf2wrapping&&!e.isPowerOfTwo,t)}onSourceUnload(e){var t=this._glTextures[e.uid];t&&(this.unbind(e),this._glTextures[e.uid]=null,this._gl.deleteTexture(t.texture))}onSourceUpdate(e){var t=this._gl,r=this.getGlSource(e);t.bindTexture(t.TEXTURE_2D,r.texture),this._boundTextures[this._activeTextureLocation]=e,this._uploads[e.uploadMethodId]?this._uploads[e.uploadMethodId].upload(e,r,t,this._renderer.context.webGLVersion):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.pixelWidth,e.pixelHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),e.autoGenerateMipmaps&&1<e.mipLevelCount&&this.onUpdateMipmaps(e,!1)}onUpdateMipmaps(e,t=!0){t&&this.bindSource(e,0);t=this.getGlSource(e);this._gl.generateMipmap(t.target)}onSourceDestroy(e){e.off("destroy",this.onSourceDestroy,this),e.off("update",this.onSourceUpdate,this),e.off("resize",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("styleChange",this.onStyleChange,this),e.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}_initSampler(e){var t=this._gl,r=this._gl.createSampler();return this._glSamplers[e._resourceId]=r,Le(e,t,1<this._boundTextures[this._activeTextureLocation].mipLevelCount,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",r,!1,!0),this._glSamplers[e._resourceId]}_getGlSampler(e){return this._glSamplers[e._resourceId]||this._initSampler(e)}getGlSource(e){return this._glTextures[e.uid]||this._initSource(e)}generateCanvas(e){var{pixels:e,width:t,height:r}=this.getPixels(e),s=R.e.get().createCanvas(),a=(s.width=t,s.height=r,s.getContext("2d"));return a&&((t=a.createImageData(t,r)).data.set(e),a.putImageData(t,0,0)),s}getPixels(e){var t=e.source.resolution,r=e.frame,s=Math.max(Math.round(r.width*t),1),a=Math.max(Math.round(r.height*t),1),n=new Uint8Array(4*s*a),i=this._renderer,e=i.renderTarget.getRenderTarget(e),e=i.renderTarget.getGpuRenderTarget(e),i=i.gl;return i.bindFramebuffer(i.FRAMEBUFFER,e.resolveTargetFramebuffer),i.readPixels(Math.round(r.x*t),Math.round(r.y*t),s,a,i.RGBA,i.UNSIGNED_BYTE,n),{pixels:new Uint8ClampedArray(n.buffer),width:s,height:a}}destroy(){this.managedTextures.slice().forEach(e=>this.onSourceDestroy(e)),this.managedTextures=null,this._renderer=null}}Me.extension={type:[e.Ag.WebGLSystem],name:"texture"};t=[...v.i,ue,A,p,k,Me,he,z,Ne,pe,J,G,te,Q],A=[...v.f],p=[E,f,l];const He=[],we=[],ke=[];e.XO.handleByNamedList(e.Ag.WebGLSystem,He),e.XO.handleByNamedList(e.Ag.WebGLPipes,we),e.XO.handleByNamedList(e.Ag.WebGLPipesAdaptor,ke),e.XO.add(...t,...A,...p);class Ve extends M.k{constructor(){super({name:"webgl",type:H.W.WEBGL,systems:He,renderPipes:we,renderPipeAdaptors:ke})}}},108:(e,t,r)=>{r.d(t,{v:()=>n});var s=r(9104),t=r(7222),a=new Int32Array(s.k);for(let e=0;e<s.k;e++)a[e]=e;const n=new t.k({uTextures:{value:a,type:"i32",size:s.k}},{isStatic:!0})}}]);