"use strict";(self.webpackChunkal=self.webpackChunkal||[]).push([[557],{2557:(U,e,t)=>{t.r(e);function o(e){return void 0!==e&&"MacIntel"===e.platform&&"number"==typeof e.maxTouchPoints&&1<e.maxTouchPoints&&"undefined"==typeof MSStream}var e=t(8507),i=t(4263),s=t(7566),r=/iPhone/i,a=/iPod/i,h=/iPad/i,l=/\biOS-universal(?:.+)Mac\b/i,d=/\bAndroid(?:.+)Mobile\b/i,p=/Android/i,c=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,v=/Silk/i,u=/Windows Phone/i,m=/\bWindows(?:.+)ARM\b/i,g=/BlackBerry/i,y=/BB10/i,E=/Opera Mini/i,b=/\b(CriOS|Chrome)(?:.+)Mobile/i,_=/Mobile(?:.+)Firefox\b/i;function n(e){var t,i={userAgent:"",platform:"",maxTouchPoints:0},e=(e||"undefined"==typeof navigator?"string"==typeof e?i.userAgent=e:e&&e.userAgent&&(i={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}):i={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0},i.userAgent),n=e.split("[FBAN"),n=(void 0!==(n=(e=void 0!==n[1]?n[0]:e).split("Twitter"))[1]&&(e=n[0]),t=e,function(e){return e.test(t)}),e={apple:{phone:n(r)&&!n(u),ipod:n(a),tablet:!n(r)&&(n(h)||o(i))&&!n(u),universal:n(l),device:(n(r)||n(a)||n(h)||n(l)||o(i))&&!n(u)},amazon:{phone:n(c),tablet:!n(c)&&n(v),device:n(c)||n(v)},android:{phone:!n(u)&&n(c)||!n(u)&&n(d),tablet:!n(u)&&!n(c)&&!n(d)&&(n(v)||n(p)),device:!n(u)&&(n(c)||n(v)||n(d)||n(p))||n(/\bokhttp\b/i)},windows:{phone:n(u),tablet:n(m),device:n(u)||n(m)},other:{blackberry:n(g),blackberry10:n(y),opera:n(E),firefox:n(_),chrome:n(b),device:n(g)||n(y)||n(E)||n(_)||n(b)},any:!1,phone:!1,tablet:!1};return e.any=e.apple.device||e.android.device||e.windows.device||e.other.device,e.phone=e.apple.phone||e.android.phone||e.windows.phone,e.tablet=e.apple.tablet||e.android.tablet||e.windows.tablet,e}const f=(n.default??n)(globalThis.navigator);var T=t(9903);class P{constructor(e,t=f){this._mobileInfo=t,this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(t.tablet||t.phone)&&this._createTouchHook();t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex=2..toString(),this._div=t,this._renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){var e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.add(this),this._renderer.view.canvas.parentNode?.appendChild(this._div))}_deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this),this._div.parentNode?.removeChild(this._div))}_updateAccessibleObjects(e){if(e.visible&&e.accessibleChildren){e.accessible&&e.isInteractive()&&(e._accessibleActive||this._addChild(e),e._renderId=this._renderId);var t=e.children;if(t)for(let e=0;e<t.length;e++)this._updateAccessibleObjects(t[e])}}init(e){this.debug=e?.debug??this.debug,this._renderer.runners.postrender.remove(this)}postrender(){var e=performance.now();if(!(this._mobileInfo.android.device&&e<this._androidUpdateCount)&&(this._androidUpdateCount=e+this._androidUpdateFrequency,this._renderer.renderingToScreen)&&this._renderer.view.canvas){this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered);var{x:e,y:i,width:n,height:o}=this._renderer.view.canvas.getBoundingClientRect(),{width:s,height:r,resolution:a}=this._renderer,h=n/s*a,l=o/r*a;let t=this._div;t.style.left=e+"px",t.style.top=i+"px",t.style.width=s+"px",t.style.height=r+"px";for(let e=0;e<this._children.length;e++){var d,p,c=this._children[e];c._renderId!==this._renderId?((c._accessibleActive=!1,T.d)(this._children,e,1),this._div.removeChild(c._accessibleDiv),this._pool.push(c._accessibleDiv),c._accessibleDiv=null,e--):(t=c._accessibleDiv,d=c.hitArea,p=c.worldTransform,c.hitArea?(t.style.left=(p.tx+d.x*p.a)*h+"px",t.style.top=(p.ty+d.y*p.d)*l+"px",t.style.width=d.width*p.a*h+"px",t.style.height=d.height*p.d*l+"px"):(d=c.getBounds().rectangle,this._capHitArea(d),t.style.left=d.x*h+"px",t.style.top=d.y*l+"px",t.style.width=d.width*h+"px",t.style.height=d.height*l+"px",t.title!==c.accessibleTitle&&null!==c.accessibleTitle&&(t.title=c.accessibleTitle||""),t.getAttribute("aria-label")!==c.accessibleHint&&null!==c.accessibleHint&&t.setAttribute("aria-label",c.accessibleHint||"")),c.accessibleTitle===t.title&&c.tabIndex===t.tabIndex||(t.title=c.accessibleTitle||"",t.tabIndex=c.tabIndex,this.debug&&this._updateDebugHTML(t)))}this._renderId++}}_updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: `+e.tabIndex}_capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);var{width:t,height:i}=this._renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>i&&(e.height=i-e.y)}_addChild(e){let t=this._pool.pop();t||((t=document.createElement("button")).style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2..toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:e.accessibleHint&&null!==e.accessibleHint||(t.title="container "+e.tabIndex),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this._updateDebugHTML(t),e._accessibleActive=!0,(e._accessibleDiv=t).container=e,this._children.push(e),this._div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){e=e.target.container;const i=this._renderer.events.rootBoundary,n=Object.assign(new s.N(i),{target:e});i.rootTarget=this._renderer.lastObjectRendered,t.forEach(e=>i.dispatchEvent(n,e))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){9===e.keyCode&&this._activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this._deactivate()}destroy(){this._destroyTouchHook(),this._div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this._pool=null,this._children=null,this._renderer=null}}P.extension={type:[e.Ag.WebGLSystem,e.Ag.WebGPUSystem],name:"accessibility"};e.XO.add(P),i.mc.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,_renderId:-1}),t(4732);var w=t(4486),M=t(5101),A=t(268),D=t(4458),k=t(7309);const I=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){!this._tickerAdded&&this.domElement&&(k.R.system.add(this._tickerUpdate,this,D.d.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){this._tickerAdded&&(k.R.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){var e;this.domElement&&!this._pauseUpdate&&(this._didMove?this._didMove=!1:(e=this.events._rootPointerEvent,this.events.supportsTouchEvents&&"touch"===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))))}_tickerUpdate(e){this._deltaTime+=e.deltaTime,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this._update())}};var O=t(3285),L=t(4935);class x extends O._{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}x.DOM_DELTA_PIXEL=0,x.DOM_DELTA_LINE=1,x.DOM_DELTA_PAGE=2;const R=new M.b,B=new M.b;class F{constructor(e){this.dispatch=new w.A,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((e,t)=>e.priority-t.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(i){if(this.rootTarget){var n=this.mappingTable[i.type];if(n)for(let e=0,t=n.length;e<t;e++)n[e].fn(i);else(0,A.R)("[EventBoundary]: Event mapping not defined for "+i.type)}}hitTest(e,t){I.pauseUpdate=!0;e=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,R.set(e,t),this.hitTestFn,this.hitPruneFn);return e&&e[0]}propagate(i,n){if(i.target){var o=i.composedPath();i.eventPhase=i.CAPTURING_PHASE;for(let e=0,t=o.length-1;e<t;e++)if(i.currentTarget=o[e],this.notifyTarget(i,n),i.propagationStopped||i.propagationImmediatelyStopped)return;if(i.eventPhase=i.AT_TARGET,i.currentTarget=i.target,this.notifyTarget(i,n),!i.propagationStopped&&!i.propagationImmediatelyStopped){i.eventPhase=i.BUBBLING_PHASE;for(let e=o.length-2;0<=e;e--)if(i.currentTarget=o[e],this.notifyTarget(i,n),i.propagationStopped||i.propagationImmediatelyStopped)return}}}all(i,e,n=this._allInteractiveElements){if(0!==n.length){i.eventPhase=i.BUBBLING_PHASE;var o=Array.isArray(e)?e:[e];for(let t=n.length-1;0<=t;t--)o.forEach(e=>{i.currentTarget=n[t],this.notifyTarget(i,e)})}}propagationPath(t){var i=[t];for(let e=0;e<2048&&t!==this.rootTarget&&t.parent;e++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");i.push(t.parent),t=t.parent}return i.reverse(),i}hitTestMoveRecursive(t,i,n,o,s,r=!1){let a=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==i||(I.pauseUpdate=!1),t.interactiveChildren&&t.children){var h=t.children;for(let e=h.length-1;0<=e;e--){var l,d=h[e],d=this.hitTestMoveRecursive(d,this._isInteractive(i)?i:d.eventMode,n,o,s,r||s(t,n));!d||0<d.length&&!d[d.length-1].parent||(l=t.isInteractive(),(0<d.length||l)&&(l&&this._allInteractiveElements.push(t),d.push(t)),0===this._hitElements.length&&(this._hitElements=d),a=!0)}}var e=this._isInteractive(i),p=t.isInteractive();return p&&this._allInteractiveElements.push(t),r||0<this._hitElements.length?null:a?this._hitElements:e&&!s(t,n)&&o(t,n)?p?[t]:[]:null}hitTestRecursive(t,i,e,n,o){if(this._interactivePrune(t)||o(t,e))return null;if("dynamic"!==t.eventMode&&"dynamic"!==i||(I.pauseUpdate=!1),t.interactiveChildren&&t.children){var s=t.children,r=e;for(let e=s.length-1;0<=e;e--){var a,h=s[e],h=this.hitTestRecursive(h,this._isInteractive(i)?i:h.eventMode,r,n,o);if(h)if(!(0<h.length)||h[h.length-1].parent)return a=t.isInteractive(),(0<h.length||a)&&h.push(t),h}}var l=this._isInteractive(i),d=t.isInteractive();return l&&n(t,e)?d?[t]:[]:null}_isInteractive(e){return"static"===e||"dynamic"===e}_interactivePrune(e){return!(e&&e.visible&&e.renderable)||"none"===e.eventMode||"passive"===e.eventMode&&!e.interactiveChildren}hitPruneFn(t,i){if(t.hitArea&&(t.worldTransform.applyInverse(i,B),!t.hitArea.contains(B.x,B.y)))return!0;if(t.effects&&t.effects.length)for(let e=0;e<t.effects.length;e++){var n=t.effects[e];if(n.containsPoint)if(!n.containsPoint(i,this.hitTestFn))return!0}return!1}hitTestFn(e,t){return!!e.hitArea||!!e?.containsPoint&&(e.worldTransform.applyInverse(t,B),e.containsPoint(B))}notifyTarget(e,t){t=t??e.type;e.currentTarget["on"+t]?.(e);var i=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?t+"capture":t;this._notifyListeners(e,i),e.eventPhase===e.AT_TARGET&&this._notifyListeners(e,t)}mapPointerDown(e){var t,i;e instanceof L.A?(t=this.createPointerEvent(e),this.dispatchEvent(t,"pointerdown"),"touch"===t.pointerType?this.dispatchEvent(t,"touchstart"):"mouse"!==t.pointerType&&"pen"!==t.pointerType||(i=2===t.button,this.dispatchEvent(t,i?"rightdown":"mousedown")),this.trackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)):(0,A.R)("EventBoundary cannot map a non-pointer event as a pointer event")}mapPointerMove(t){if(t instanceof L.A){this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;var i=this.createPointerEvent(t),n=(this._isPointerMoveEvent=!1,"mouse"===i.pointerType||"pen"===i.pointerType),e=this.trackingData(t.pointerId),o=this.findMountedTarget(e.overTargets);if(0<e.overTargets?.length&&o!==i.target){var s="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,s,o);if(this.dispatchEvent(s,"pointerout"),n&&this.dispatchEvent(s,"mouseout"),!i.composedPath().includes(o)){var r=this.createPointerEvent(t,"pointerleave",o);for(r.eventPhase=r.AT_TARGET;r.target&&!i.composedPath().includes(r.target);)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;this.freeEvent(r)}this.freeEvent(s)}if(o!==i.target){s="mousemove"===t.type?"mouseover":"pointerover",t=this.clonePointerEvent(i,s);this.dispatchEvent(t,"pointerover"),n&&this.dispatchEvent(t,"mouseover");let e=o?.parent;for(;e&&e!==this.rootTarget.parent&&e!==i.target;)e=e.parent;if(!e||e===this.rootTarget.parent){var a=this.clonePointerEvent(i,"pointerenter");for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==o&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),n&&this.notifyTarget(a,"mouseenter"),a.target=a.target.parent;this.freeEvent(a)}this.freeEvent(t)}s=[],t=this.enableGlobalMoveEvents??!0;this.moveOnAll?s.push("pointermove"):this.dispatchEvent(i,"pointermove"),t&&s.push("globalpointermove"),"touch"===i.pointerType&&(this.moveOnAll?s.splice(1,0,"touchmove"):this.dispatchEvent(i,"touchmove"),t)&&s.push("globaltouchmove"),n&&(this.moveOnAll?s.splice(1,0,"mousemove"):this.dispatchEvent(i,"mousemove"),t&&s.push("globalmousemove"),this.cursor=i.target?.cursor),0<s.length&&this.all(i,s),this._allInteractiveElements.length=0,this._hitElements.length=0,e.overTargets=i.composedPath(),this.freeEvent(i)}else(0,A.R)("EventBoundary cannot map a non-pointer event as a pointer event")}mapPointerOver(e){if(e instanceof L.A){var t=this.trackingData(e.pointerId),e=this.createPointerEvent(e),i="mouse"===e.pointerType||"pen"===e.pointerType,n=(this.dispatchEvent(e,"pointerover"),i&&this.dispatchEvent(e,"mouseover"),"mouse"===e.pointerType&&(this.cursor=e.target?.cursor),this.clonePointerEvent(e,"pointerenter"));for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;t.overTargets=e.composedPath(),this.freeEvent(e),this.freeEvent(n)}else(0,A.R)("EventBoundary cannot map a non-pointer event as a pointer event")}mapPointerOut(e){if(e instanceof L.A){var t=this.trackingData(e.pointerId);if(t.overTargets){var i="mouse"===e.pointerType||"pen"===e.pointerType,n=this.findMountedTarget(t.overTargets),o=this.createPointerEvent(e,"pointerout",n),s=(this.dispatchEvent(o),i&&this.dispatchEvent(o,"mouseout"),this.createPointerEvent(e,"pointerleave",n));for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;t.overTargets=null,this.freeEvent(o),this.freeEvent(s)}this.cursor=null}else(0,A.R)("EventBoundary cannot map a non-pointer event as a pointer event")}mapPointerUp(i){if(i instanceof L.A){var n,e=performance.now(),o=this.createPointerEvent(i),s=(this.dispatchEvent(o,"pointerup"),"touch"===o.pointerType?this.dispatchEvent(o,"touchend"):"mouse"!==o.pointerType&&"pen"!==o.pointerType||(s=2===o.button,this.dispatchEvent(o,s?"rightup":"mouseup")),this.trackingData(i.pointerId)),r=this.findMountedTarget(s.pressTargetsByButton[i.button]);let t=r;if(r&&!o.composedPath().includes(r)){let e=r;for(;e&&!o.composedPath().includes(e);)o.currentTarget=e,this.notifyTarget(o,"pointerupoutside"),"touch"===o.pointerType?this.notifyTarget(o,"touchendoutside"):"mouse"!==o.pointerType&&"pen"!==o.pointerType||(n=2===o.button,this.notifyTarget(o,n?"rightupoutside":"mouseupoutside")),e=e.parent;delete s.pressTargetsByButton[i.button],t=e}t&&((r=this.clonePointerEvent(o,"click")).target=t,r.path=null,s.clicksByButton[i.button]||(s.clicksByButton[i.button]={clickCount:0,target:r.target,timeStamp:e}),(s=s.clicksByButton[i.button]).target===r.target&&e-s.timeStamp<200?++s.clickCount:s.clickCount=1,s.target=r.target,s.timeStamp=e,r.detail=s.clickCount,"mouse"===r.pointerType?(i=2===r.button,this.dispatchEvent(r,i?"rightclick":"click")):"touch"===r.pointerType&&this.dispatchEvent(r,"tap"),this.dispatchEvent(r,"pointertap"),this.freeEvent(r)),this.freeEvent(o)}else(0,A.R)("EventBoundary cannot map a non-pointer event as a pointer event")}mapPointerUpOutside(t){if(t instanceof L.A){var i=this.trackingData(t.pointerId),n=this.findMountedTarget(i.pressTargetsByButton[t.button]),o=this.createPointerEvent(t);if(n){let e=n;for(;e;)o.currentTarget=e,this.notifyTarget(o,"pointerupoutside"),"touch"===o.pointerType?this.notifyTarget(o,"touchendoutside"):"mouse"!==o.pointerType&&"pen"!==o.pointerType||this.notifyTarget(o,2===o.button?"rightupoutside":"mouseupoutside"),e=e.parent;delete i.pressTargetsByButton[t.button]}this.freeEvent(o)}else(0,A.R)("EventBoundary cannot map a non-pointer event as a pointer event")}mapWheel(e){e instanceof x?(e=this.createWheelEvent(e),this.dispatchEvent(e),this.freeEvent(e)):(0,A.R)("EventBoundary cannot map a non-wheel event as a wheel event")}findMountedTarget(t){if(!t)return null;let i=t[0];for(let e=1;e<t.length&&t[e].parent===i;e++)i=t[e];return i}createPointerEvent(e,t,i){var n=this.allocateEvent(L.A);return this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.nativeEvent=e.nativeEvent,n.originalEvent=e,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],"string"==typeof t&&(n.type=t),n}createWheelEvent(e){var t=this.allocateEvent(x);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){var i=this.allocateEvent(L.A);return i.nativeEvent=e.nativeEvent,i.originalEvent=e.originalEvent,this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.target=e.target,i.path=e.composedPath().slice(),i.type=t??i.type,i}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof L.A&&t instanceof L.A&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof O._&&t instanceof O._&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);e=this.eventPool.get(e).pop()||new e(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");var t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}_notifyListeners(i,n){var o=i.currentTarget._events[n];if(o&&i.currentTarget.isInteractive())if("fn"in o)o.once&&i.currentTarget.removeListener(n,o.fn,void 0,!0),o.fn.call(o.context,i);else for(let e=0,t=o.length;e<t&&!i.propagationImmediatelyStopped;e++)o[e].once&&i.currentTarget.removeListener(n,o[e].fn,void 0,!0),o[e].fn.call(o[e].context,i)}}const X={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},C=class C{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new F(null),I.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new L.A(null),this._rootWheelEvent=new x(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...C.defaultEventFeatures},{set:(e,t,i)=>("globalMove"===t&&(this.rootBoundary.enableGlobalMoveEvents=i),e[t]=i,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){var{canvas:t,resolution:i}=this.renderer;this.setTargetElement(t),this.resolution=i,C._defaultEventMode=e.eventMode??"passive",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this._currentCursor!==e){this._currentCursor=e;var i=this.cursorStyles[e];if(i)switch(typeof i){case"string":t&&(this.domElement.style.cursor=i);break;case"function":i(e);break;case"object":t&&Object.assign(this.domElement.style,i)}else t&&"string"==typeof e&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}}get pointer(){return this._rootPointerEvent}_onPointerDown(e){if(this.features.click){this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;var i=this._normalizeToPointerData(e);!this.autoPreventDefault||!i[0].isNormalized||!e.cancelable&&"cancelable"in e||e.preventDefault();for(let e=0,t=i.length;e<t;e++){var n=i[e],n=this._bootstrapEvent(this._rootPointerEvent,n);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}}_onPointerMove(e){if(this.features.move){this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,I.pointerMoved();var i=this._normalizeToPointerData(e);for(let e=0,t=i.length;e<t;e++){var n=this._bootstrapEvent(this._rootPointerEvent,i[e]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}}_onPointerUp(t){if(this.features.click){this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;var i=(e=t.composedPath&&0<t.composedPath().length?t.composedPath()[0]:e)!==this.domElement?"outside":"",n=this._normalizeToPointerData(t);for(let e=0,t=n.length;e<t;e++){var o=this._bootstrapEvent(this._rootPointerEvent,n[e]);o.type+=i,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}}_onPointerOverOut(e){if(this.features.click){this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;var i=this._normalizeToPointerData(e);for(let e=0,t=i.length;e<t;e++){var n=this._bootstrapEvent(this._rootPointerEvent,i[e]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}}onWheel(e){this.features.wheel&&(e=this.normalizeWheelEvent(e),this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e))}setTargetElement(e){this._removeEvents(),this.domElement=e,I.domElement=e,this._addEvents()}_addEvents(){var e;!this._eventsAdded&&this.domElement&&(I.addTickerListener(),(e=this.domElement.style)&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0)}_removeEvents(){var e;this._eventsAdded&&this.domElement&&(I.removeTickerListener(),(e=this.domElement.style)&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction="")),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1)}mapPositionToPoint(e,t,i){var n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},o=1/this.resolution;e.x=(t-n.left)*(this.domElement.width/n.width)*o,e.y=(i-n.top)*(this.domElement.height/n.height)*o}_normalizeToPointerData(i){var e,n=[];if(this.supportsTouchEvents&&i instanceof TouchEvent)for(let e=0,t=i.changedTouches.length;e<t;e++){var o=i.changedTouches[e];void 0===o.button&&(o.button=0),void 0===o.buttons&&(o.buttons=1),void 0===o.isPrimary&&(o.isPrimary=1===i.touches.length&&"touchstart"===i.type),void 0===o.width&&(o.width=o.radiusX||1),void 0===o.height&&(o.height=o.radiusY||1),void 0===o.tiltX&&(o.tiltX=0),void 0===o.tiltY&&(o.tiltY=0),void 0===o.pointerType&&(o.pointerType="touch"),void 0===o.pointerId&&(o.pointerId=o.identifier||0),void 0===o.pressure&&(o.pressure=o.force||.5),void 0===o.twist&&(o.twist=0),void 0===o.tangentialPressure&&(o.tangentialPressure=0),void 0===o.layerX&&(o.layerX=o.offsetX=o.clientX),void 0===o.layerY&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=i.type,n.push(o)}else!globalThis.MouseEvent||i instanceof MouseEvent&&!(this.supportsPointerEvents&&i instanceof globalThis.PointerEvent)?(void 0===(e=i).isPrimary&&(e.isPrimary=!0),void 0===e.width&&(e.width=1),void 0===e.height&&(e.height=1),void 0===e.tiltX&&(e.tiltX=0),void 0===e.tiltY&&(e.tiltY=0),void 0===e.pointerType&&(e.pointerType="mouse"),void 0===e.pointerId&&(e.pointerId=1),void 0===e.pressure&&(e.pressure=.5),void 0===e.twist&&(e.twist=0),void 0===e.tangentialPressure&&(e.tangentialPressure=0),e.isNormalized=!0,n.push(e)):n.push(i);return n}normalizeWheelEvent(e){var t=this._rootWheelEvent;return this._transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}_bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this._transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=X[e.type]||e.type),e}_transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};C.extension={name:"events",type:[e.Ag.WebGLSystem,e.Ag.CanvasSystem,e.Ag.WebGPUSystem],priority:-1},C.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let S=C;M={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return"dynamic"===this.eventMode||"static"===this.eventMode},set interactive(e){this.eventMode=e?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??S.defaultEventMode},set eventMode(e){this._internalEventMode=e},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(e,t,i){var n="boolean"==typeof i&&i||"object"==typeof i&&i.capture,o="object"==typeof i?i.signal:void 0,i="object"==typeof i&&!0===i.once;const s="function"==typeof t?void 0:t,r=(e=n?e+"capture":e,"function"==typeof t?t:t.handleEvent),a=this;o&&o.addEventListener("abort",()=>{a.off(e,r,s)}),i?a.once(e,r,s):a.on(e,r,s)},removeEventListener(e,t,i){var i="boolean"==typeof i&&i||"object"==typeof i&&i.capture,n="function"==typeof t?void 0:t;t="function"==typeof t?t:t.handleEvent,this.off(e=i?e+"capture":e,t,n)},dispatchEvent(e){if(e instanceof s.N)return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented;throw new Error("Container cannot propagate events outside of the Federated Events API")}};e.XO.add(S),i.mc.mixin(M),t(9010),t(8480),t(8928),t(5285),t(6958),t(8883),t(5154),t(8723),t(7252),t(9935)}}]);